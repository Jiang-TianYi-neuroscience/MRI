#IMPORTANT warning
str1="Please make sure you know what you are doing !!!"  
str2="Otherwise , try to type those commands word by word."
echo -e "\033[1;41;33m ${str1} \033[0m" 
echo -e "\033[1;41;33m ${str2} \033[0m"
#input necessary info
read -e -n20 -a subid -p subid:
read -e -n20 -a anat -p anat:
read -e -n20 -a i -p run:
read -e -n10 -a blur_size -p blur_size:
read -e -n10 -a l_bp -p low_bandpass:
read -e -n10 -a h_bp -p high_bandpass:
read -e -n10 -a dxyz  -p master_dxyz:
read -e -n10 -a rm_tr -p remove_TRs:
read -e -n10 -a reg -p align_type_a/c:
#data list
prefix=${subid}_$i
epi=${subid}_${i}_epi+orig.HEAD

#RS ANALYSIS
afni_proc.py                                                             \
 -subj_id $prefix                                                        \
 -blocks despike tshift align tlrc volreg mask blur scale regress        \
 -copy_anat ${subid}_${anat}_anat*_ns.nii.gz                             \
 -anat_has_skull  no                                                     \
 -dsets $epi                                                             \
 -tcat_remove_first_trs $rm_tr                                           \
 -align_unifize_epi local                                                \
 -align_opts_aea -cost $reg+ZZ -cmass cmass+a  -check_flip -ginormous_move         \
 -tlrc_base "NMT_v2.0_sym_05mm_SS.nii.gz"                                          \
 -tlrc_NL_warp                                                                     \
 -tlrc_NL_warped_dsets  ${subid}_${anat}_anat*_warp2std_nsu.nii.gz                 \
                        ${subid}_${anat}_anat*_composite_linear_to_template.1D     \
                        ${subid}_${anat}_anat*_shft_WARP.nii.gz                    \
 -volreg_align_to MIN_OUTLIER                                                                                          \
 -volreg_align_e2a                                                                                                     \
 -volreg_tlrc_warp                                                                                                     \
 -blur_size $blur_size                                                                                                 \
 -mask_segment_anat yes                                                                                                \
 -mask_segment_erode yes                                                                                               \
 -volreg_warp_dxyz $dxyz                                                                                               \
 -mask_import Tvent "NMT_v2.0_sym_05mm_ventricles.nii.gz"                                                              \
 -mask_intersect Svent CSFe Tvent                                                                                      \
 -mask_epi_anat yes                                                                                                    \
 -mask_apply    anat                                                                                                   \
 -regress_motion_per_run                                                                                               \
 -regress_ROI_PC Svent 3                                                                                               \
 -regress_ROI_PC_per_run Svent                                                                                         \
 -regress_make_corr_vols WMe Svent                                                                                     \
 -regress_anaticor_fast                                                                                                \
 -regress_bandpass $l_bp $h_bp                                                                                         \
 -regress_censor_motion 0.5                                                                                            \
 -regress_censor_outliers 0.05                                                                                         \
 -regress_apply_mot_types demean deriv                                                                                 \
 -regress_est_blur_epits                                                                                               \
 -regress_est_blur_errts                                                                                               \
 -regress_run_clustsim  yes                                                                                            \
 -html_review_style pythonic

#run script
tcsh -xef proc.$prefix 2>&1 | tee output.proc.$prefix

